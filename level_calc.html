<html>
  <head>
  <title> ”枠”の計算（作成中） | 新・CYCLES FUNの寝言（仮） </title>
  <meta charaset="utf-8">
  <meta name="viewport" content="width=device-width,user-scalable=no,maximum-scale=1" />
  <link rel="stylesheet" media="all" type="text/css" href="css/style.css" />
  <link rel="stylesheet" media="all" type="text/css" href="css/tablet.css" />
  <link rel="stylesheet" media="all" type="text/css" href="css/smartphone.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="scripts/mai_inner_level.js"></script>
  <script src="scripts/calc_rating.js"></script>
  <script type="text/javascript" language="javascript">
  function mra_level_calc()
    {
      var tmp = 0, current_level=0, music_top=0;
      var rate_list=[], recent_list=[0,0,0,0,0,0,0,0,0,0], best_tmp=0, best_waku=0;
      var disp_best=0, disp_rcnt=0, disp_hist=0, disp_calc=0;
      for(var i=0; i<$('[id=id_achi]').length; i++)
      {
        if($('[id=id_achi]')[i].value == "")
        {
          rate_list.push("");
          continue;
        }

        if((Number($('[id=id_achi]')[i].value) < 80) || (104 < (Number($('[id=id_achi]')[i].value))))
        {
          $('[id=out_rate]')[i].innerHTML = "Error";
          return;
        }
           
        if($('[id=id_lv]')[i].value != "")
        {
          current_level=$('[id=id_lv]')[i].value;
        }
        tmp = mra_arch2rate_10000($('[id=id_achi]')[i].value, current_level);
        $('[id=out_rate]')[i].innerHTML = Math.floor(tmp/100)/100;
        rate_list.push(tmp);
      }
      
      for(i=0; i<rate_list.length; i++)
      {
        tmp = rate_list[i];
        if(tmp =="")
        {
          best_waku += best_tmp;
          best_tmp = 0;
          continue;
        }
        
        best_tmp=Math.max(Number(tmp), best_tmp);
        recent_list.push(tmp);
        recent_list=recent_list.sort(function(a,b){return b - a;});
        recent_list.pop();
        
        disp_best = (best_waku+best_tmp)/44;
        disp_rcnt = (recent_list.reduce((a,x) => a+=x,0))/44;
        disp_hist = (best_waku+best_tmp)/4778;
        console.log(i + " : best " + disp_best + " : rcnt " + disp_rcnt + " : hist " + disp_hist;
        disp_calc = Math.floor(disp_best/100) + Math.floor(disp_rcnt/100) + Math.floor(disp_hist/100);
        disp_calc /= 100;
        
        $('[id=out_best]')[i].innerHTML = Math.floor(disp_best)/10000;
        $('[id=out_rect]')[i].innerHTML = Math.floor(disp_rcnt)/10000;
        $('[id=out_hist]')[i].innerHTML = Math.floor(disp_hist)/10000;
        $('[id=out_calc]')[i].innerHTML = disp_calc;
     }
      
    }
    
  function mra_reset_input_data()
  {
    for(var i=0; i<$('[id=id_achi]').length; i++)
    {
      $('[id=id_lv]')[i].innerHTML = "";
      $('[id=id_achi]')[i].innerHTML = "";
      $('[id=id_rate]')[i].innerHTML = "";
    }
    return;
  }
    
  function mra_reset_output_result()
  {
      for(var i=0; i<$('[id=id_achi]').length; i++)
      {
        $('[id=out_rate]')[i].innerHTML = "";
        $('[id=out_calc]')[i].innerHTML = "";
        $('[id=out_best]')[i].innerHTML = "";
        $('[id=out_rect]')[i].innerHTML = "";
        $('[id=out_hist]')[i].innerHTML = "";
      }
    
    return;
  }
    
  function mra_button_calc()
  {
    mra_reset_output_result();
    mra_level_calc();
  }
  
  function mra_button_reset()
  {
    mra_reset_input_data();
    mra_reset_output_result();
  }

  </script>
  </head>
  
  <body>
  
  <h1>”枠”の計算</h1>
  
  <p>枠を計算するためのツールです。半分人力です。</p>
  
  <h2>使い方</h2>
    <p>まだナイショ。入力すれば何かわかるかも。</p>

  <form name=rate_result>
  <table border=0 align=center>
  <tr>
    <th>内部<br>Lv.</th>
    <th>達成<br>率(%)</th>
    <th>表示<br>Rat<br>ing</th>
    <th></th>
    <th>単曲<br>レート<br>値</th>
    <th>算出<br>Rat<br>ing</th>
    <th>BEST<br>枠</th>
    <th>RCNT<br>枠</th>
    <th>HIST<br>枠</th>
  </tr>
  
  <tr>
    <td><input type=text align=center name=lv id=id_lv size=2 maxlength=4></td>
    <td><input type=text align=center name=achi id=id_achi size=3 maxlength=6></td>
    <td><input type=text align=center name=rate id=id_rate size=3 maxlength=5></td>
    <td></td>
    <td id=out_rate align=center></td>
    <td id=out_calc align=center></td>
    <td id=out_best align=center></td>
    <td id=out_rect align=center></td>
    <td id=out_hist align=center></td>
  </tr>
 
  <tr>
    <td><input type=text align=center name=lv id=id_lv size=2 maxlength=4></td>
    <td><input type=text align=center name=achi id=id_achi size=3 maxlength=6></td>
    <td><input type=text align=center name=rate id=id_rate size=3 maxlength=5></td>
    <td></td>
    <td id=out_rate align=center></td>
    <td id=out_calc align=center></td>
    <td id=out_best align=center></td>
    <td id=out_rect align=center></td>
    <td id=out_hist align=center></td>
  </tr>

   <tr>
    <td><input type=text align=center name=lv id=id_lv size=2 maxlength=4></td>
    <td><input type=text align=center name=achi id=id_achi size=3 maxlength=6></td>
    <td><input type=text align=center name=rate id=id_rate size=3 maxlength=5></td>
    <td></td>
    <td id=out_rate align=center></td>
    <td id=out_calc align=center></td>
    <td id=out_best align=center></td>
    <td id=out_rect align=center></td>
    <td id=out_hist align=center></td>
  </tr>

   <tr>
    <td><input type=text align=center name=lv id=id_lv size=2 maxlength=4></td>
    <td><input type=text align=center name=achi id=id_achi size=3 maxlength=6></td>
    <td><input type=text align=center name=rate id=id_rate size=3 maxlength=5></td>
    <td></td>
    <td id=out_rate align=center></td>
    <td id=out_calc align=center></td>
    <td id=out_best align=center></td>
    <td id=out_rect align=center></td>
    <td id=out_hist align=center></td>
  </tr>

   <tr>
    <td><input type=text align=center name=lv id=id_lv size=2 maxlength=4></td>
    <td><input type=text align=center name=achi id=id_achi size=3 maxlength=6></td>
    <td><input type=text align=center name=rate id=id_rate size=3 maxlength=5></td>
    <td></td>
    <td id=out_rate align=center></td>
    <td id=out_calc align=center></td>
    <td id=out_best align=center></td>
    <td id=out_rect align=center></td>
    <td id=out_hist align=center></td>
  </tr>

   <tr>
    <td><input type=text align=center name=lv id=id_lv size=2 maxlength=4></td>
    <td><input type=text align=center name=achi id=id_achi size=3 maxlength=6></td>
    <td><input type=text align=center name=rate id=id_rate size=3 maxlength=5></td>
    <td></td>
    <td id=out_rate align=center></td>
    <td id=out_calc align=center></td>
    <td id=out_best align=center></td>
    <td id=out_rect align=center></td>
    <td id=out_hist align=center></td>
  </tr>

   <tr>
    <td><input type=text align=center name=lv id=id_lv size=2 maxlength=4></td>
    <td><input type=text align=center name=achi id=id_achi size=3 maxlength=6></td>
    <td><input type=text align=center name=rate id=id_rate size=3 maxlength=5></td>
    <td></td>
    <td id=out_rate align=center></td>
    <td id=out_calc align=center></td>
    <td id=out_best align=center></td>
    <td id=out_rect align=center></td>
    <td id=out_hist align=center></td>
  </tr>

   <tr>
    <td><input type=text align=center name=lv id=id_lv size=2 maxlength=4></td>
    <td><input type=text align=center name=achi id=id_achi size=3 maxlength=6></td>
    <td><input type=text align=center name=rate id=id_rate size=3 maxlength=5></td>
    <td></td>
    <td id=out_rate align=center></td>
    <td id=out_calc align=center></td>
    <td id=out_best align=center></td>
    <td id=out_rect align=center></td>
    <td id=out_hist align=center></td>
  </tr>

   <tr>
    <td><input type=text align=center name=lv id=id_lv size=2 maxlength=4></td>
    <td><input type=text align=center name=achi id=id_achi size=3 maxlength=6></td>
    <td><input type=text align=center name=rate id=id_rate size=3 maxlength=5></td>
    <td></td>
    <td id=out_rate align=center></td>
    <td id=out_calc align=center></td>
    <td id=out_best align=center></td>
    <td id=out_rect align=center></td>
    <td id=out_hist align=center></td>
  </tr>

   <tr>
    <td><input type=text align=center name=lv id=id_lv size=2 maxlength=4></td>
    <td><input type=text align=center name=achi id=id_achi size=3 maxlength=6></td>
    <td><input type=text align=center name=rate id=id_rate size=3 maxlength=5></td>
    <td></td>
    <td id=out_rate align=center></td>
    <td id=out_calc align=center></td>
    <td id=out_best align=center></td>
    <td id=out_rect align=center></td>
    <td id=out_hist align=center></td>
  </tr>

    <tr>
    <td><input type=text align=center name=lv id=id_lv size=2 maxlength=4></td>
    <td><input type=text align=center name=achi id=id_achi size=3 maxlength=6></td>
    <td><input type=text align=center name=rate id=id_rate size=3 maxlength=5></td>
    <td></td>
    <td id=out_rate align=center></td>
    <td id=out_calc align=center></td>
    <td id=out_best align=center></td>
    <td id=out_rect align=center></td>
    <td id=out_hist align=center></td>
  </tr>

   <tr>
    <td><input type=text align=center name=lv id=id_lv size=2 maxlength=4></td>
    <td><input type=text align=center name=achi id=id_achi size=3 maxlength=6></td>
    <td><input type=text align=center name=rate id=id_rate size=3 maxlength=5></td>
    <td></td>
    <td id=out_rate align=center></td>
    <td id=out_calc align=center></td>
    <td id=out_best align=center></td>
    <td id=out_rect align=center></td>
    <td id=out_hist align=center></td>
  </tr>

   <tr>
    <td><input type=text align=center name=lv id=id_lv size=2 maxlength=4></td>
    <td><input type=text align=center name=achi id=id_achi size=3 maxlength=6></td>
    <td><input type=text align=center name=rate id=id_rate size=3 maxlength=5></td>
    <td></td>
    <td id=out_rate align=center></td>
    <td id=out_calc align=center></td>
    <td id=out_best align=center></td>
    <td id=out_rect align=center></td>
    <td id=out_hist align=center></td>
  </tr>

 </table>
  <center>
  <input type=button value="計算" value="Exec" onclick="mra_button_calc()">
  <input type=button value="リセット" value="Exec" onclick="mra_button_reset()">
  </center>
  </form>
  </body>
</html>
